version: '3'

services:
  pacman-arch:
    image: docker.pkg.github.com/yamaoka-kitaguchi-lab/archlinux-mirror:latest
    build:
      context: pacman/archlinux
    volumes:
      - ./pacman/exclude.txt:/exclude.txt
      - /srv/mirror/archlinux:/var/spool/pacman-mirror

  apt-ubuntu:
    image: docker.pkg.github.com/yamaoka-kitaguchi-lab/ubuntu-mirror:latest
    build:
      context: apt/ubuntu
    volumes:
      - /srv/mirror/ubuntu:/var/spool/apt-mirror/mirror/ftp.jaist.ac.jp/ubuntu

  apt-debian:
    image: docker.pkg.github.com/yamaoka-kitaguchi-lab/debian-mirror:latest
    build:
      context: apt/debian
    volumes:
      - /srv/mirror/debian:/var/spool/apt-mirror/mirror/ftp.jp.debian.org/debian

  apt-raspberrypi:
    image: docker.pkg.github.com/yamaoka-kitaguchi-lab/raspberrypi-mirror:latest
    build:
      context: apt/raspberrypi
    volumes:
      - /srv/mirror/raspberrypi/raspbian:/var/spool/apt-mirror/mirror/ftp.tsukuba.wide.ad.jp/Linux/raspbian/raspbian

  nginx-apt:
    image: docker.pkg.github.com/yamaoka-kitaguchi-lab/mirror-index-nginx:latest
    build:
      context: nginx
    ports:
      - 10.0.5.11:80:80
    volumes:
      - /srv/mirror/ubuntu:/usr/share/nginx/apt/ubuntu:ro
      - /srv/mirror/debian:/usr/share/nginx/apt/debian:ro
      - /srv/mirror/raspberrypi:/usr/share/nginx/apt/raspberrypi:ro

  nginx-pacman:
    image: docker.pkg.github.com/yamaoka-kitaguchi-lab/mirror-index-nginx:latest
    build:
      context: nginx
    ports:
      - 10.0.5.12:80:80
    volumes:
      - /srv/mirror/archlinux:/usr/share/nginx/pacman/archlinux:ro
